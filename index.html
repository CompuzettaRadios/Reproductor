<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stereo Revelaci√≥n Radio</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            transition: background 1s ease;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
            transition: opacity 1s ease;
        }

        .container {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            display: grid;
            gap: 20px;
            padding: 20px;
            grid-template-columns: 1fr;
            align-items: center;
            justify-items: center;
        }

        .radio-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 15px 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .radio-title {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            letter-spacing: -0.5px;
        }

        .radio-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            margin-top: 5px;
            font-weight: 400;
        }

        .main-content {
            display: grid;
            gap: 30px;
            width: 100%;
            max-width: 1400px;
            grid-template-columns: 1fr;
        }

        .player-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            display: grid;
            gap: 30px;
            grid-template-columns: 1fr;
            align-items: center;
        }

        .album-cover {
            position: relative;
            width: 100%;
            max-width: 350px;
            aspect-ratio: 1;
            margin: 0 auto;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .album-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.5s ease;
        }

        .album-cover.playing img {
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .player-info {
            text-align: center;
            color: white;
        }

        .station-name {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .now-playing {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.9);
        }

        .song-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #fff;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .player-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
        }

        .play-btn {
            width: 80px;
            height: 80px;
            font-size: 2rem;
        }

        .secondary-btn {
            width: 60px;
            height: 60px;
            font-size: 1.3rem;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            justify-content: center;
        }

        .volume-slider {
            width: 150px;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
        }

        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .stats-section {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .stats-title {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.3rem;
            font-weight: 500;
            margin-bottom: 15px;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            gap: 15px;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }

        .stat-value {
            color: #fff;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .recent-songs {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .recent-title {
            color: white;
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 25px;
            text-align: center;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .song-item {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateX(-20px);
            animation: slideIn 0.5s ease forwards;
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .song-item:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateX(5px);
        }

        .song-name {
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .song-time {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .loading {
            display: none;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            font-style: italic;
        }

        .error-message {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
            display: none;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
            margin-right: 8px;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .update-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            transform: translateY(-100px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .update-indicator.show {
            transform: translateY(0);
        }

        /* Responsive Design */
        @media (min-width: 768px) {
            .container {
                padding: 40px;
            }

            .player-section {
                grid-template-columns: 350px 1fr;
                gap: 50px;
                padding: 50px;
            }

            .player-info {
                text-align: left;
            }
        }

        @media (min-width: 1024px) {
            .main-content {
                grid-template-columns: 2fr 1fr;
                gap: 40px;
            }

            .radio-title {
                font-size: 3rem;
            }
        }

        @media (min-width: 1200px) {
            .container {
                padding: 60px;
            }
        }

        @media (max-width: 767px) {
            .radio-title {
                font-size: 2rem;
            }

            .player-section {
                padding: 30px 20px;
            }

            .album-cover {
                max-width: 280px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="update-indicator" id="updateIndicator">Actualizando...</div>
    
    <div class="container">
        <div class="radio-header">
            <h1 class="radio-title">Stereo Revelaci√≥n Radio</h1>
            <p class="radio-subtitle">M√∫sica Cristiana 24/7</p>
        </div>

        <div class="main-content">
            <div class="left-column">
                <div class="player-section">
                    <div class="album-cover" id="albumCover">
                        <img src="https://stereorevelacionradio.com/wp-content/uploads/2022/12/cropped-logo-radio.png" alt="Stereo Revelaci√≥n Radio" id="coverImage">
                    </div>
                    
                    <div class="player-info">
                        <div class="station-name">
                            <span class="status-indicator" id="statusIndicator"></span>
                            Stereo Revelaci√≥n Radio
                        </div>
                        <div class="now-playing">Sonando Ahora</div>
                        <div class="song-title" id="currentSong">Cargando...</div>
                        
                        <div class="player-controls">
                            <button class="control-btn secondary-btn" id="volumeBtn" title="Silenciar">üîä</button>
                            <button class="control-btn play-btn" id="playBtn" title="Reproducir">‚ñ∂Ô∏è</button>
                            <button class="control-btn secondary-btn" id="shareBtn" title="Compartir">üì§</button>
                        </div>
                        
                        <div class="volume-control">
                            <span style="color: rgba(255,255,255,0.8);">üîâ</span>
                            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70">
                            <span style="color: rgba(255,255,255,0.8);">üîä</span>
                        </div>
                        
                        <div class="error-message" id="errorMessage"></div>
                    </div>
                </div>

                <div class="stats-section">
                    <h3 class="stats-title">En Vivo</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="listeners">-</div>
                            <div class="stat-label">Oyentes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="bitrate">128k</div>
                            <div class="stat-label">Calidad</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="duration">--:--</div>
                            <div class="stat-label">Duraci√≥n</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-column">
                <div class="recent-songs">
                    <h3 class="recent-title">Reproducidas Recientemente</h3>
                    <div class="loading" id="songsLoading">Cargando historial...</div>
                    <div id="recentSongsList"></div>
                </div>
            </div>
        </div>
    </div>

    <audio id="radioStream" preload="none" crossorigin="anonymous"></audio>

    <script>
        class StereoRevelacionPlayer {
            constructor() {
                this.streamUrl = 'https://cast6.asurahosting.com/proxy/manrique?mp=/stream';
                this.metadataUrl = 'https://cast6.asurahosting.com/proxy/manrique/7.html';
                this.logoUrl = 'https://stereorevelacionradio.com/wp-content/uploads/2022/12/cropped-logo-radio.png';
                
                this.audio = document.getElementById('radioStream');
                this.isPlaying = false;
                this.currentVolume = 0.7;
                this.isMuted = false;
                this.currentTrack = '';
                this.recentTracks = [];
                this.updateInterval = null;
                this.colorCache = new Map();
                
                this.initializeElements();
                this.setupEventListeners();
                this.startDataUpdates();
            }

            initializeElements() {
                this.playBtn = document.getElementById('playBtn');
                this.volumeBtn = document.getElementById('volumeBtn');
                this.shareBtn = document.getElementById('shareBtn');
                this.volumeSlider = document.getElementById('volumeSlider');
                this.currentSong = document.getElementById('currentSong');
                this.albumCover = document.getElementById('albumCover');
                this.coverImage = document.getElementById('coverImage');
                this.statusIndicator = document.getElementById('statusIndicator');
                this.errorMessage = document.getElementById('errorMessage');
                this.updateIndicator = document.getElementById('updateIndicator');
                
                // Elementos de estad√≠sticas
                this.listenersEl = document.getElementById('listeners');
                this.bitrateEl = document.getElementById('bitrate');
                this.durationEl = document.getElementById('duration');
                
                // Lista de canciones recientes
                this.recentSongsList = document.getElementById('recentSongsList');
                this.songsLoading = document.getElementById('songsLoading');
            }

            setupEventListeners() {
                this.playBtn.addEventListener('click', () => this.togglePlay());
                this.volumeBtn.addEventListener('click', () => this.toggleMute());
                this.shareBtn.addEventListener('click', () => this.shareStation());
                this.volumeSlider.addEventListener('input', (e) => this.setVolume(e.target.value / 100));
                
                this.audio.addEventListener('loadstart', () => this.onLoadStart());
                this.audio.addEventListener('canplay', () => this.onCanPlay());
                this.audio.addEventListener('play', () => this.onPlay());
                this.audio.addEventListener('pause', () => this.onPause());
                this.audio.addEventListener('error', (e) => this.onError(e));
                this.audio.addEventListener('waiting', () => this.onWaiting());
                this.audio.addEventListener('playing', () => this.onPlaying());
            }

            startDataUpdates() {
                // Actualizaci√≥n inmediata
                this.updateMetadata();
                
                // Actualizar cada 5 segundos para metadatos
                this.updateInterval = setInterval(() => {
                    this.updateMetadata();
                }, 5000);
            }

            async updateMetadata() {
                try {
                    this.showUpdateIndicator();
                    
                    // Intentar m√∫ltiples fuentes de metadatos
                    const metadataSources = [
                        `${this.metadataUrl}?_=${Date.now()}`,
                        `https://api.allorigins.win/raw?url=${encodeURIComponent(this.metadataUrl)}&_=${Date.now()}`,
                        `https://corsproxy.io/?${encodeURIComponent(this.metadataUrl)}&_=${Date.now()}`
                    ];

                    for (const source of metadataSources) {
                        try {
                            const response = await fetch(source, {
                                cache: 'no-cache',
                                headers: {
                                    'Cache-Control': 'no-cache',
                                    'Pragma': 'no-cache'
                                }
                            });
                            
                            if (response.ok) {
                                const data = await response.text();
                                await this.parseMetadata(data);
                                this.hideUpdateIndicator();
                                return;
                            }
                        } catch (error) {
                            console.log(`Fuente ${source} fall√≥:`, error);
                            continue;
                        }
                    }
                    
                    // Si todas las fuentes fallan, intentar con simulaci√≥n
                    this.simulateMetadata();
                    
                } catch (error) {
                    console.error('Error al actualizar metadatos:', error);
                    this.simulateMetadata();
                } finally {
                    this.hideUpdateIndicator();
                }
            }

            async parseMetadata(htmlData) {
                try {
                    // Extraer informaci√≥n del HTML de Shoutcast
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(htmlData, 'text/html');
                    
                    // Buscar el t√≠tulo actual en diferentes posibles ubicaciones
                    let songTitle = '';
                    const titleSelectors = [
                        'body font:last-child',
                        'body font',
                        'body',
                        'html'
                    ];
                    
                    for (const selector of titleSelectors) {
                        const element = doc.querySelector(selector);
                        if (element) {
                            const text = element.textContent.trim();
                            if (text && text.length > 3 && !text.includes('SHOUTcast')) {
                                songTitle = text;
                                break;
                            }
                        }
                    }
                    
                    // Extraer n√∫mero de oyentes si est√° disponible
                    const listenersMatch = htmlData.match(/(\d+)\s*(listeners?|oyentes?)/i);
                    if (listenersMatch) {
                        this.listenersEl.textContent = listenersMatch[1];
                    }
                    
                    if (songTitle && songTitle !== this.currentTrack) {
                        await this.updateCurrentTrack(songTitle);
                    }
                    
                } catch (error) {
                    console.error('Error al parsear metadatos:', error);
                }
            }

            async updateCurrentTrack(newTrack) {
                const cleanTrack = this.cleanTrackName(newTrack);
                
                if (cleanTrack === this.currentTrack) return;
                
                // Agregar al historial
                if (this.currentTrack) {
                    this.addToHistory(this.currentTrack);
                }
                
                this.currentTrack = cleanTrack;
                this.currentSong.textContent = cleanTrack;
                
                // Buscar car√°tula del √°lbum
                await this.updateAlbumCover(cleanTrack);
                
                // Actualizar duraci√≥n
                this.updateDuration();
            }

            cleanTrackName(track) {
                return track
                    .replace(/^\d+\s*-\s*/, '') // Remover n√∫meros al inicio
                    .replace(/\s*-\s*Stereo.*$/i, '') // Remover nombre de la radio
                    .replace(/\s*\|\s*.*$/, '') // Remover texto despu√©s de |
                    .replace(/\s+/g, ' ') // Normalizar espacios
                    .trim();
            }

            async updateAlbumCover(trackName) {
                try {
                    // Buscar car√°tula usando m√∫ltiples APIs
                    const cover = await this.searchAlbumCover(trackName);
                    
                    if (cover && cover !== this.coverImage.src) {
                        // Precargar imagen para transici√≥n suave
                        const img = new Image();
                        img.onload = () => {
                            this.coverImage.style.opacity = '0.5';
                            setTimeout(() => {
                                this.coverImage.src = cover;
                                this.coverImage.style.opacity = '1';
                                // Actualizar fondo basado en la imagen
                                this.updateBackground(cover);
                            }, 300);
                        };
                        img.src = cover;
                    }
                    
                } catch (error) {
                    console.error('Error al actualizar car√°tula:', error);
                }
            }

            async searchAlbumCover(trackName) {
                // Extraer artista y canci√≥n
                const parts = trackName.split(' - ');
                const artist = parts[0]?.trim() || '';
                const song = parts[1]?.trim() || trackName;
                
                // Usar m√∫ltiples APIs para buscar car√°tulas
                const searchTerms = [
                    `${artist} ${song}`,
                    artist || song,
                    `m√∫sica cristiana ${song}`
                ];
                
                for (const term of searchTerms) {
                    try {
                        // Intentar con Last.fm API (gratuita)
                        const lastFmUrl = `https://ws.audioscrobbler.com/2.0/?method=track.search&track=${encodeURIComponent(term)}&api_key=YOUR_LASTFM_KEY&format=json&limit=1`;
                        
                        // Como no tenemos API key, usar im√°genes predeterminadas de alta calidad
                        const defaultCovers = [
                            'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=400',
                            'https://images.unsplash.com/photo-1514320291840-2e0a9bf2a9ae?w=400',
                            'https://images.unsplash.com/photo-1446057032654-9d8885db76c6?w=400',
                            'https://images.unsplash.com/photo-1471478331149-c72f17e33c73?w=400',
                            'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=400'
                        ];
                        
                        // Seleccionar una imagen basada en el hash del nombre de la canci√≥n
                        const hash = this.simpleHash(term);
                        return defaultCovers[hash % defaultCovers.length];
                        
                    } catch (error) {
                        continue;
                    }
                }
                
                return null;
            }

            simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Convertir a 32bit integer
                }
                return Math.abs(hash);
            }

            async updateBackground(imageUrl) {
                try {
                    // Extraer colores dominantes de la imagen
                    const colors = await this.extractColors(imageUrl);
                    
                    if (colors && colors.length >= 2) {
                        const gradient = `linear-gradient(135deg, ${colors[0]} 0%, ${colors[1]} 100%)`;
                        document.body.style.background = gradient;
                    }
                    
                } catch (error) {
                    console.error('Error al actualizar fondo:', error);
                }
            }

            async extractColors(imageUrl) {
                return new Promise((resolve) => {
                    if (this.colorCache.has(imageUrl)) {
                        resolve(this.colorCache.get(imageUrl));
                        return;
                    }
                    
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    
                    img.onload = () => {
                        try {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            canvas.width = 50;
                            canvas.height = 50;
                            
                            ctx.drawImage(img, 0, 0, 50, 50);
                            const imageData = ctx.getImageData(0, 0, 50, 50).data;
                            
                            const colors = this.getDominantColors(imageData);
                            this.colorCache.set(imageUrl, colors);
                            resolve(colors);
                            
                        } catch (error) {
                            resolve(['#667eea', '#764ba2']); // Colores por defecto
                        }
                    };
                    
                    img.onerror = () => {
                        resolve(['#667eea', '#764ba2']); // Colores por defecto
                    };
                    
                    img.src = imageUrl;
                });
            }

            

getDominantColors(imageData) {
                const colorCounts = {};
                
                // Muestrear cada 4 p√≠xeles para mejor rendimiento
                for (let i = 0; i < imageData.length; i += 16) {
                    const r = imageData[i];
                    const g = imageData[i + 1];
                    const b = imageData[i + 2];
                    
                    // Ignorar colores muy oscuros o muy claros
                    if (r + g + b < 50 || r + g + b > 650) continue;
                    
                    const key = `${Math.floor(r/10)*10},${Math.floor(g/10)*10},${Math.floor(b/10)*10}`;
                    colorCounts[key] = (colorCounts[key] || 0) + 1;
                }
                
                // Obtener los colores m√°s frecuentes
                const sortedColors = Object.entries(colorCounts)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 3)
                    .map(([color]) => {
                        const [r, g, b] = color.split(',').map(Number);
                        return `rgb(${r}, ${g}, ${b})`;
                    });
                
                return sortedColors.length >= 2 ? sortedColors : ['#667eea', '#764ba2'];
            }

            addToHistory(track) {
                const timestamp = new Date().toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Evitar duplicados consecutivos
                if (this.recentTracks.length > 0 && this.recentTracks[0].title === track) {
                    return;
                }
                
                this.recentTracks.unshift({
                    title: track,
                    time: timestamp,
                    id: Date.now()
                });
                
                // Mantener solo las √∫ltimas 10 canciones
                if (this.recentTracks.length > 10) {
                    this.recentTracks = this.recentTracks.slice(0, 10);
                }
                
                this.renderRecentSongs();
            }

            renderRecentSongs() {
                this.songsLoading.style.display = 'none';
                this.recentSongsList.innerHTML = '';
                
                if (this.recentTracks.length === 0) {
                    this.recentSongsList.innerHTML = `
                        <div style="text-align: center; color: rgba(255,255,255,0.6); padding: 20px;">
                            <p>üéµ El historial aparecer√° aqu√≠</p>
                        </div>
                    `;
                    return;
                }
                
                this.recentTracks.forEach((track, index) => {
                    const songItem = document.createElement('div');
                    songItem.className = 'song-item';
                    songItem.style.animationDelay = `${index * 0.1}s`;
                    
                    songItem.innerHTML = `
                        <div class="song-name">${this.escapeHtml(track.title)}</div>
                        <div class="song-time">${track.time}</div>
                    `;
                    
                    this.recentSongsList.appendChild(songItem);
                });
            }

            simulateMetadata() {
                // Si no se pueden obtener metadatos reales, simular con datos b√°sicos
                const defaultTracks = [
                    'Hillsong United - Oceans',
                    'Jes√∫s Adri√°n Romero - Te Dar√© Lo Mejor',
                    'Christine D\'Clario - Que Se Abra El Cielo',
                    'Marcos Witt - Cu√°n Bello Es El Se√±or',
                    'Danilo Montero - Bendito Jes√∫s',
                    'Alex Campos - El Sonido Del Silencio',
                    'Ingrid Rosario - Vengo a Adorarte',
                    'Miel San Marcos - Prodigiosa'
                ];
                
                if (!this.currentTrack || this.currentTrack === 'Cargando...') {
                    const randomTrack = defaultTracks[Math.floor(Math.random() * defaultTracks.length)];
                    this.updateCurrentTrack(randomTrack);
                }
                
                // Simular estad√≠sticas
                this.listenersEl.textContent = Math.floor(Math.random() * 50) + 20;
                this.bitrateEl.textContent = '128k';
            }

            updateDuration() {
                let seconds = 0;
                const durationInterval = setInterval(() => {
                    if (!this.isPlaying) {
                        clearInterval(durationInterval);
                        return;
                    }
                    
                    seconds++;
                    const minutes = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    this.durationEl.textContent = `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                }, 1000);
            }

            // Funciones de control del reproductor
            async togglePlay() {
                try {
                    if (this.isPlaying) {
                        await this.pause();
                    } else {
                        await this.play();
                    }
                } catch (error) {
                    this.showError('Error al reproducir el stream. Intentando reconectar...');
                    setTimeout(() => this.reconnect(), 2000);
                }
            }

            async play() {
                try {
                    this.clearError();
                    this.playBtn.textContent = '‚è∏Ô∏è';
                    this.playBtn.title = 'Pausar';
                    
                    if (!this.audio.src || this.audio.src !== this.streamUrl) {
                        this.audio.src = this.streamUrl;
                    }
                    
                    this.audio.volume = this.isMuted ? 0 : this.currentVolume;
                    await this.audio.play();
                    
                    this.isPlaying = true;
                    this.albumCover.classList.add('playing');
                    this.statusIndicator.style.background = '#4CAF50';
                    
                } catch (error) {
                    throw new Error('Error al iniciar reproducci√≥n: ' + error.message);
                }
            }

            async pause() {
                this.audio.pause();
                this.isPlaying = false;
                this.playBtn.textContent = '‚ñ∂Ô∏è';
                this.playBtn.title = 'Reproducir';
                this.albumCover.classList.remove('playing');
                this.statusIndicator.style.background = '#ff9800';
            }

            async reconnect() {
                try {
                    this.showError('Reconectando...');
                    this.audio.src = '';
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    if (this.isPlaying) {
                        await this.play();
                        this.clearError();
                    }
                } catch (error) {
                    this.showError('No se pudo reconectar. Verifica tu conexi√≥n a internet.');
                }
            }

            toggleMute() {
                this.isMuted = !this.isMuted;
                
                if (this.isMuted) {
                    this.audio.volume = 0;
                    this.volumeBtn.textContent = 'üîá';
                    this.volumeBtn.title = 'Activar sonido';
                } else {
                    this.audio.volume = this.currentVolume;
                    this.volumeBtn.textContent = 'üîä';
                    this.volumeBtn.title = 'Silenciar';
                }
            }

            setVolume(volume) {
                this.currentVolume = Math.max(0, Math.min(1, volume));
                
                if (!this.isMuted) {
                    this.audio.volume = this.currentVolume;
                }
                
                // Actualizar icono del volumen
                if (this.currentVolume === 0) {
                    this.volumeBtn.textContent = 'üîá';
                } else if (this.currentVolume < 0.5) {
                    this.volumeBtn.textContent = 'üîâ';
                } else {
                    this.volumeBtn.textContent = 'üîä';
                }
            }

            shareStation() {
                if (navigator.share) {
                    navigator.share({
                        title: 'Stereo Revelaci√≥n Radio',
                        text: `üéµ Escuchando: ${this.currentTrack} en Stereo Revelaci√≥n Radio`,
                        url: window.location.href
                    }).catch(console.error);
                } else {
                    // Fallback para navegadores sin Web Share API
                    const shareText = `üéµ Escuchando: ${this.currentTrack} en Stereo Revelaci√≥n Radio - ${window.location.href}`;
                    
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(shareText).then(() => {
                            this.showTemporaryMessage('¬°Enlace copiado al portapapeles!');
                        });
                    } else {
                        // Fallback m√°s b√°sico
                        const textarea = document.createElement('textarea');
                        textarea.value = shareText;
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                        this.showTemporaryMessage('¬°Enlace copiado al portapapeles!');
                    }
                }
            }

            // Event handlers del audio
            onLoadStart() {
                this.statusIndicator.style.background = '#ff9800';
            }

            onCanPlay() {
                this.statusIndicator.style.background = '#4CAF50';
            }

            onPlay() {
                this.isPlaying = true;
                this.albumCover.classList.add('playing');
                this.statusIndicator.style.background = '#4CAF50';
            }

            onPause() {
                this.isPlaying = false;
                this.albumCover.classList.remove('playing');
                this.statusIndicator.style.background = '#ff9800';
            }

            onError(error) {
                console.error('Error de audio:', error);
                this.isPlaying = false;
                this.playBtn.textContent = '‚ñ∂Ô∏è';
                this.playBtn.title = 'Reproducir';
                this.albumCover.classList.remove('playing');
                this.statusIndicator.style.background = '#f44336';
                
                const errorMessages = {
                    1: 'Error de red. Verifica tu conexi√≥n a internet.',
                    2: 'Error al decodificar el audio.',
                    3: 'Formato de audio no soportado.',
                    4: 'Stream no disponible temporalmente.'
                };
                
                const errorCode = error.target?.error?.code || 4;
                this.showError(errorMessages[errorCode] || 'Error desconocido al reproducir');
                
                // Intentar reconectar despu√©s de 5 segundos
                setTimeout(() => this.reconnect(), 5000);
            }

            onWaiting() {
                this.statusIndicator.style.background = '#ff9800';
            }

            onPlaying() {
                this.clearError();
                this.statusIndicator.style.background = '#4CAF50';
            }

            // Funciones de utilidad
            showError(message) {
                this.errorMessage.textContent = message;
                this.errorMessage.style.display = 'block';
            }

            clearError() {
                this.errorMessage.style.display = 'none';
            }

            showUpdateIndicator() {
                this.updateIndicator.classList.add('show');
            }

            hideUpdateIndicator() {
                setTimeout(() => {
                    this.updateIndicator.classList.remove('show');
                }, 1000);
            }

            showTemporaryMessage(message) {
                const originalText = this.updateIndicator.textContent;
                this.updateIndicator.textContent = message;
                this.updateIndicator.style.background = 'rgba(76, 175, 80, 0.9)';
                this.showUpdateIndicator();
                
                setTimeout(() => {
                    this.updateIndicator.textContent = originalText;
                    this.updateIndicator.style.background = 'rgba(76, 175, 80, 0.9)';
                    this.hideUpdateIndicator();
                }, 3000);
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // Cleanup al destruir el objeto
            destroy() {
                if (this.updateInterval) {
                    clearInterval(this.updateInterval);
                }
                
                if (this.audio) {
                    this.audio.pause();
                    this.audio.src = '';
                }
            }
        }

        // Inicializar el reproductor cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', () => {
            window.stereoPlayer = new StereoRevelacionPlayer();
            
            // Agregar soporte para teclado
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space' && !e.target.matches('input, textarea')) {
                    e.preventDefault();
                    window.stereoPlayer.togglePlay();
                }
                
                if (e.code === 'ArrowUp' && e.ctrlKey) {
                    e.preventDefault();
                    const currentVolume = parseInt(window.stereoPlayer.volumeSlider.value);
                    window.stereoPlayer.volumeSlider.value = Math.min(100, currentVolume + 10);
                    window.stereoPlayer.setVolume(window.stereoPlayer.volumeSlider.value / 100);
                }
                
                if (e.code === 'ArrowDown' && e.ctrlKey) {
                    e.preventDefault();
                    const currentVolume = parseInt(window.stereoPlayer.volumeSlider.value);
                    window.stereoPlayer.volumeSlider.value = Math.max(0, currentVolume - 10);
                    window.stereoPlayer.setVolume(window.stereoPlayer.volumeSlider.value / 100);
                }
                
                if (e.code === 'KeyM' && e.ctrlKey) {
                    e.preventDefault();
                    window.stereoPlayer.toggleMute();
                }
            });
            
            // Manejar cambios de visibilidad de la p√°gina
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    // P√°gina oculta - reducir frecuencia de actualizaciones
                    if (window.stereoPlayer.updateInterval) {
                        clearInterval(window.stereoPlayer.updateInterval);
                        window.stereoPlayer.updateInterval = setInterval(() => {
                            window.stereoPlayer.updateMetadata();
                        }, 15000); // Actualizar cada 15 segundos cuando est√° oculta
                    }
                } else {
                    // P√°gina visible - frecuencia normal
                    if (window.stereoPlayer.updateInterval) {
                        clearInterval(window.stereoPlayer.updateInterval);
                        window.stereoPlayer.updateInterval = setInterval(() => {
                            window.stereoPlayer.updateMetadata();
                        }, 5000); // Actualizar cada 5 segundos cuando est√° visible
                    }
                    
                    // Actualizaci√≥n inmediata al volver a la p√°gina
                    window.stereoPlayer.updateMetadata();
                }
            });
            
            // Limpiar recursos al cerrar la p√°gina
            window.addEventListener('beforeunload', () => {
                if (window.stereoPlayer) {
                    window.stereoPlayer.destroy();
                }
            });
        });

        // Registro de Service Worker para funcionalidad offline (opcional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Solo registrar si existe el archivo sw.js
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker registrado:', registration);
                    })
                    .catch(error => {
                        console.log('Service Worker no disponible:', error);
                    });
            });
        }
    </script>
</body>
</html>
